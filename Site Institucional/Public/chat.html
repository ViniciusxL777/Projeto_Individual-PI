<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hueco Mundo | Bleach_Info</title>
    <link rel="stylesheet" href="styles/chat.css">
    <link rel="shortcut icon" href="assets/icons/Logo-ContornoSemFundo.png" type="image/x-icon">
</head>

<body onload="trazerTodosDebates()">

    <!-- NAVBAR -->
    <nav class="navbar">
        <div class="navbar-logo">
            <img style="width: 140px; height: 140px;" src="assets/icons/Logo-ContornoSemFundo.png" alt="Logo">
        </div>
        <ul>
            <li><a href="index.html">Inicio</a></li>
            <select id="select_informacao" onchange="mudarPagina()">
                <option value="">Informações</option>
                <option value="sociedade_das_almas.html">Sociedade Das Almas</option>
                <option value="hueco_mundo.html">Hueco Mundo</option>
                <option value="sociedade_quincy.html">Sociedade Quincy</option>
                <option value="shinigami.html">Shinigami</option>
                <option value="hollow_arrancars.html">Hollow/Arrancars</option>
                <option value="quincy.html">Quincy</option>
            </select>
            <li><a href="quiz.html">Quiz</a></li>
            <li><a href="sobreNos.html">Sobre nós</a></li>
        </ul>
        <ul class="login">
            <div id="imagemPerfil"><img style="width: 100px; height: 100px;"
                    src="assets/icons/Icone-Shinigami-SemFundo.png" alt=""></div>
            <li>
                <a href="perfil.html">
                    <div id="nome"></div>
                </a>
            </li>
        </ul>
    </nav>

    <!-- CONTEÚDO -->
    <div class="conteudo">
        <div class="titulo_debate">
            <h1>Crie seus debates aqui!!!</h1>
            <div class="criarDebates">
                <h3>Digite o título do seu debate:</h3>
                <input type="text" id="input_criarDebate" class="input_criar">
                <button onclick="cadastrarDebate()">Cadastrar Debate</button>
            </div>
            <div id="geral">
                <!-- <div id="debateDados${idDebate[o - 1]}">
                    <div class="debate" id="${idDebate[o - 1]}">
                        <button onclick="trazerConteudoDebate()">
                            <p>Debate</p>
                        </button>
                    </div>
                    <div class="sub_titulo" id="">
                        <div class="texto-imagem">
                            <div class="texto">
                                <h2><button onclick="trazerConteudoDebate()">Titulo Debate</button></h2>
                                <div class="sub_conteudo" id="${debateEscolhido}">
                                    <div class="comentario">
                                        <div class="usuarioComentario" id="usuarioComentario">
                                            <p>ViniciusxL</p>
                                            <img src="assets/icons/Icone-Arrancara-SemFundo.png" alt="">
                                        </div>
                                        <div class="comentarioTexto">
                                            <p>Lorem ipsum dolor, sit amet consectetur adipisicing elit. Eos, cupiditate
                                                dolore
                                                corrupti
                                                perferendis provident suscipit consequuntur. Laudantium ut perspiciatis,
                                                veniam
                                                doloremque vitae, atque deleniti repudiandae illo vel, repellat optio
                                                obcaecati?
                                            </p>
                                        </div>
                                        <div class="imagens"><img
                                                src="assets/imgs/Quincy - Ataques De Flechas Espirituais.png" alt="">
                                        </div>
                                    </div>
                                    <div class="comentar">
                                        <div class="comentar">
                                            <p>Comentar:</p>
                                            <div class="comentarCampos">
                                                <input type="text" class="inputComentarTexto"
                                                    placeholder="Escreva seu comentário...">
                                                <label for="foto" class="comentarImagem">Escolher imagem</label>
                                                <input type="file" id="foto" class="inputComentarImagem" hidden>
                                            </div>
                                            <button>Enviar Comentário</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div> -->
            </div>
        </div>
    </div>

    <!-- RODAPÉ -->
    <footer>
        <div class="redirecionamento">
            <div class="link_footer">
                <h1>REDES SOCIAIS</h1>
                <div class="link">
                    <a href=""><img src="assets/icons/Icone-Instagram.png" alt="">@bleach_info_insta</a>
                    <a href=""><img src="assets/icons/Icone-Facebook.png" alt="">@bleach_infoface</a>
                    <a href=""><img src="assets/icons/Icone-YouTube.png" alt="">@bleachinfo_yt</a>
                </div>
            </div>
            <div class="link_footer">
                <h1>CONTATO</h1>
                <div class="link">
                    <a href=""><img src="assets/icons/Icone-Telefone.png" alt="">+55 11 930068513</a>
                    <a href=""><img src="assets/icons/Icone-Email.png" alt="">bleach_info@gmal.com</a>
                </div>
            </div>
            <div class="link_footer">
                <h1>MAPA DO SITE</h1>
                <div class="link2">
                    <a href="index.html">home<img class="img1" src="assets/icons/Icone-Link.png" alt=""></a>
                    <a href="login.html">informações<img class="img1" src="assets/icons/Icone-Link.png" alt=""></a>
                    <a href="login.html">Quiz<img class="img1" src="assets/icons/Icone-Link.png" alt=""></a>
                    <a href="sobreNos.html">Sobre Nós<img class="img1" src="assets/icons/Icone-Link.png" alt=""></a>
                </div>
            </div>
            <div class="link_footer">
                <h1>INFORMAÇÕES</h1>
                <div class="link2">
                    <a href="sociedade_das_almas.html">Sociedade das Almas<img class="img1"
                            src="assets/icons/Icone-Link.png" alt=""></a>
                    <a href="hueco_mundo.html">Hueco Mundo<img class="img1" src="assets/icons/Icone-Link.png"
                            alt=""></a>
                    <a href="sociedade_quincy.html">Sociedade Quincy<img class="img1" src="assets/icons/Icone-Link.png"
                            alt=""></a>
                    <a href="shinigami.html">Shinigami<img class="img1" src="assets/icons/Icone-Link.png" alt=""></a>
                    <a href="hollow_arrancara.html">Hollows/Arrancars<img class="img1" src="assets/icons/Icone-Link.png"
                            alt=""></a>
                    <a href="quincy.html">Quincy<img class="img1" src="assets/icons/Icone-Link.png" alt=""></a>
                </div>
            </div>
        </div>
        <div class="informacoes">
            <img src="assets/icons/Logo-ContornoSemFundo.png" alt="">
            <p>Copyright © 2025 | BLEACH_INFO</p>
            <p><img src="assets/icons/Icone-Brasil.png" alt="">Brasil Português</p>
        </div>
    </footer>
</body>

</html>
<script>
    var idUsuario = sessionStorage.ID_USUARIO
    var nomeUsuario = sessionStorage.NOME_USUARIO
    var email = sessionStorage.EMAIL_USUARIO
    var fotoPerfil = sessionStorage.IMAGEM_PERFIL
    nome.innerHTML = sessionStorage.NOME_USUARIO
    imagemPerfil.innerHTML = `<img style="width: 100px; height: 100px;" src="assets/fotosUsuario/${sessionStorage.IMAGEM_PERFIL}" alt="">`

    var idDebate = []
    var titulo = []
    var todosDadosDebates = []
    var DadosEspecificosDebates = []
    var comentarioId = []
    var comentarioTexto = []
    var comentarioImagem = []
    var nomeComentario = []
    var perfilImagem = []
    var debateAtualIdDiv = ''
    var debateAtualIndice = 0
    var debateAtualId = 0
    var debateSelecionado
    var fecharDebateAtual
    var fecharIndiceDebate

    function mudarPagina() {
        var select = select_informacao.value
        if (select !== "") {
            window.location.href = `${select}`
        }
    }

    function cadastrarDebate() {
        var tituloDebate = input_criarDebate.value
        if (tituloDebate == '') {
            alert(`Não pode cadastrar um debate vazio`)
        } else {
            fetch(`/chatRoute/cadastrarDebate`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    pkUsuarioServer: idUsuario,
                    tituloServer: tituloDebate
                })
            })
            window.location = "chat.html"
        }
    }

    function trazerTodosDebates() {
        fetch(`/chatRoute/trazerTodosDebates`, {
            method: "GET"
        })
            .then(response => response.json())
            .then(dadosDebates => {
                idDebate = []
                titulo = []
                todosDadosDebates = dadosDebates
                for (var i = 1; i <= todosDadosDebates.length; i++) {
                    idDebate.push(todosDadosDebates[i - 1].idDebate)
                    titulo.push(todosDadosDebates[i - 1].titulo)
                }
                geral.innerHTML = ''
                for (var o = 1; o <= idDebate.length; o++) {
                    geral.innerHTML += `
                <div id="debate_${idDebate[o - 1]}">
                    <div class="debate">
                        <button onclick="trazerConteudoDebate('debate_${idDebate[o - 1]}', ${o - 1}, ${idDebate[o - 1]})">
                            <p>${titulo[o - 1]}</p>
                        </button>
                    </div>
                </div>`
                }
            })
            .catch(error => {
                console.log("Erro ao carregar debates: " + error)
            });
    }

    function trazerConteudoDebate(idDiv, indiceDebate, debateConteudo) {
        debateAtualIdDiv = idDiv
        debateAtualIndice = indiceDebate
        debateAtualId = debateConteudo

        document.getElementById(idDiv).innerHTML = `
        <div class="sub_titulo">
            <div class="texto-imagem">
                <div class="texto">
                    <h2 onclick="fecharDebate('${idDiv}', ${indiceDebate})">${titulo[indiceDebate]}</h2>
                    <div class="sub_conteudo" id="comentario_${idDiv}">
                    </div>
                </div>
            </div>
        </div>`

        fetch(`/chatRoute/buscarDadosDebate?idDebate=${debateConteudo}`, { method: "GET" })
            .then(response => response.json())
            .then(dadosDebate => {
                if (dadosDebate.length > 0) {
                    dadosDebate.forEach(resposta => {
                        document.getElementById(`comentario_${idDiv}`).innerHTML += `
                    <div class="comentario">
                        <div class="usuarioComentario">
                            <p>${resposta.nome}</p>
                            <img src="assets/fotosUsuario/${resposta.imagemPerfil}" alt="">
                        </div>
                        <div class="comentarioTexto">
                            <p>${resposta.comentario}</p>
                        </div>
                        <div class="imagens">
                            <img src="assets/imagemComentario/${resposta.imagem}" alt="">
                        </div>
                    </div>`
                    })
                }

                document.getElementById(`comentario_${idDiv}`).innerHTML += `
            <div class="comentar">
                <p>Comentar:</p>
                <div class="comentarCampos">
                    <textarea class="inputComentarTexto" id="input_comentarioTexto_${idDiv}" placeholder="Escreva seu comentário..."></textarea>
                    <label for="foto_${idDiv}" class="comentarImagem">Escolher imagem</label>
                    <input type="file" id="foto_${idDiv}" class="inputComentarImagem" hidden>
                </div>
                <button onclick="enviarComentario('${idDiv}', ${debateConteudo})">Enviar Comentário</button>
            </div>`;
            })
            .catch(err => {
                console.log(err)
            });
    }

    function enviarComentario(idDiv, debateConteudo) {
        const inputComentario = document.getElementById(`input_comentarioTexto_${idDiv}`)
        const inputFoto = document.getElementById(`foto_${idDiv}`)

        if (inputComentario.value == "" && inputFoto.files.length == 0) {
            alert(`Não é permitido comentário vazio`);
            return;
        }

        const formData = new FormData();
        formData.append('foto', inputFoto.files[0]);
        formData.append('comentario', inputComentario.value);
        formData.append('pkUsuario', idUsuario);
        formData.append('pkDebate', debateConteudo);

        fetch("/chatRoute/enviarComentarioTextoImagem", {
            method: "POST",
            body: formData
        })
            .then(res => {
                if (res.ok) {
                    alert(`Comentário enviado com sucesso!`);
                    trazerConteudoDebate(idDiv, debateAtualIndice, debateConteudo);
                } else {
                    console.error('Erro na resposta do servidor:', res.status);
                    alert('Ocorreu um erro ao enviar o comentário. Status: ' + res.status);
                }
            })
            .catch(err => {
                console.error('Erro na requisição:', err);
                alert('Erro ao enviar comentário: ' + err.message);
            });
    }

    function fecharDebate(idDiv, indiceDebate) {
        fecharDebateAtual = idDiv
        fecharIndiceDebate = indiceDebate

        document.getElementById(`${fecharDebateAtual}`).innerHTML = `
            <div id="${idDiv}">
               <div class="debate">
                    <button onclick="trazerConteudoDebate('${fecharDebateAtual}', ${fecharIndiceDebate}, ${idDebate[fecharIndiceDebate]})">
                        <p>${titulo[fecharIndiceDebate]}</p>
                    </button>
                </div>
            </div>`
    }
</script>