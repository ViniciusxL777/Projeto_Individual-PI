<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfil | Bleach_Info</title>
    <link rel="stylesheet" href="styles/perfil.css">
    <link rel="shortcut icon" href="assets/icons/Logo-ContornoSemFundo.png" type="image/x-icon">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body onload="buscarDadosResultados(), buscarDadosQuestoes(), buscarDadosQuiz()">

    <!-- NAVBAR -->
    <nav class="navbar">
        <div class="navbar-logo">
            <img style="width: 140px; height: 140px;" src="assets/icons/Logo-SemFundo.png" alt="Logo">
        </div>
        <ul>
            <li><a href="index.html">Inicio</a></li>
            <select id="select_informacao" onchange="mudarPagina()">
                <option value="">Informações</option>
                <option value="sociedade_das_almas.html">Sociedade Das Almas</option>
                <option value="hoeco_mundo.html">Hoeco Mundo</option>
                <option value="sociedade_quincy.html">Sociedade Quincy</option>
                <option value="shinigami.html">Shinigami</option>
                <option value="hollow_arrancars.html">Hollow/Arrancars</option>
                <option value="quincy.html">Quincy</option>
            </select>
            <li><a href="quiz.html">Quiz</a></li>
            <li><a href="sobreNos.html">Sobre nós</a></li>
        </ul>
        <ul class="login"><img style="width: 100px; height: 100px;" src="assets/icons/Icone-Shinigami-SemFundo.png"
                alt="icone polus">
        </ul>
    </nav>

    <div class="geral">
        <!-- CARD USUÁRIO -->
        <div class="card-usuario">
            <div class="imagem-usuario">
                <img src="assets/icons/Icone-Arrancara.png" alt="Foto do usuário">
            </div>
            <div id="nome" class="username">
            </div>
            <div class="informacoes-usuario">
                <div class="info-quiz" id="qtdQuizzes">
                    <p><span></span></p>
                    <p>Quizzes realizados</p>
                </div>
                <div class="pontuacao" id="pontosUsuarioEsquerdo">
                    <p><span></span></p>
                    <p>Pontos totais</p>
                </div>
            </div>
            <div class="exit">
                <div class="img_saida">
                    <button class="btnSaida" onclick="limparSessao()">
                        <img src="assets/icons/Icone-Exit.png" alt="Sair">
                    </button>
                </div>
                <div class="texto_saida" onclick="limparSessao()">Sair</div>
            </div>
        </div>

        <!-- DASHBOARD -->
        <div class="dashboard">
            <div class="statusUsuario">
                <div class="cardDados">
                    <div class="perguntacasRespondidas">
                        <div class="texto-container">
                            <div class="dadosCard">Perguntas</div>
                            <div class="dadosPerguntas">
                                <div class="qtdRealizadas" id="realizadas"></div>
                                <div class="qtdPergunta" id="perguntas">/ 30</div>
                            </div>
                        </div>
                        <div class="imgCard"><img src="" alt=""></div>
                    </div>
                </div>

                <div class="cardDados">
                    <div class="preguntasCorretas">
                        <div class="texto-container">
                            <div class="dadosCard">Certas</div>
                            <div class="qtdCertas" id="certa"></div>
                        </div>
                        <div class="imgCard"><img src="" alt=""></div>
                    </div>
                </div>

                <div class="cardDados">
                    <div class="perguntasErradas">
                        <div class="texto-container">
                            <div class="dadosCard">Erradas</div>
                            <div class="qtdErradas" id="errada"></div>
                        </div>
                        <div class="imgCard"><img src="" alt=""></div>
                    </div>
                </div>

                <div class="cardDados">
                    <div class="pontuacaoUsuario">
                        <div class="texto-container">
                            <div class="dadosCard">Pontuação</div>
                            <div class="dadosPontuacao">
                                <div class="dadosPontuacao" id="pontuacaoDashboard"></div>
                                <div class="todosOsPontos" id="pontuacaoTotal"></div>
                            </div>
                        </div>
                        <div class="imgCard"><img src="" alt=""></div>
                    </div>
                </div>
            </div>
            <div class="dashboardCharjs">
                <canvas>Puxar os quizzes com os seus acertos em forma de graficos de barras indo de 0 a 10</canvas>
            </div>
        </div>
    </div>

</body>

</html>
<script>
    // BUSCA DE DADOS
    var idUsuario = sessionStorage.ID_USUARIO
    var nomeUsuario = sessionStorage.NOME_USUARIO
    var email = sessionStorage.EMAIL_USUARIO
    nome.innerHTML = `<p>${nomeUsuario}</p>`

    var dadosQuestao = []
    var dadosRespostas = []
    var dadosQuizzes = []

    var todasRespondidas = []
    var qtdRespondidas = 0
    var todasRespostas = []
    var qtdCorretas = 0
    var qtdErradas = 0
    var todosPontos = []
    var totalPontos = 0
    var todosPontosQuestao = []
    var pontos = 0
    var qtdQuiz = 0
    var totalQuizzes = []
    var todasPontuacaoQuiz = []

    function mudarPagina() {
        var select = select_informacao.value
        if (select !== "") {
            window.location.href = `${select}`
        }
    }

    function limparSessao() {
        sessionStorage.clear();
        window.location = "../login.html";
    }

    function buscarDadosResultados() {
        fetch(`/perfilRoute/buscarDadosResultados?pkUsuario=${idUsuario}`)
            .then(response => response.json())
            .then(dadosResultados => {
                dadosRespostas = dadosResultados
                dadosRespostas.forEach(resposta => {
                    todasRespondidas.push(resposta.idResposta),
                        todasRespostas.push(resposta.resultadoQuestao),
                        todosPontos.push(resposta.pontosQuestao)
                });
            })

        setTimeout(() => {
            for (var i = 1; i <= todasRespostas.length; i++) {
                if (todasRespostas[i - 1] == 1) {
                    qtdCorretas += 1
                } else {
                    qtdErradas += 1
                }
            }

            for (var u = 1; u <= todosPontos.length; u++) {
                pontos += todosPontos[u - 1]
            }

            qtdRespondidas = todasRespondidas.length - 1

            qtdRespondidas += 1

            realizadas.innerHTML = `${qtdRespondidas}`
            certa.innerHTML = `${qtdCorretas}`
            errada.innerHTML = `${qtdErradas}`
            pontosUsuarioEsquerdo.innerHTML = `<p><span>${pontos}</span></p>
            <p>Pontos totais</p>`
            pontuacaoDashboard.innerHTML = `${pontos}`
        }, 100);
    }

    function buscarDadosQuestoes() {
        fetch(`/perfilRoute/buscarDadosQuestoes`)
            .then(response => response.json())
            .then(dadosQuestoes => {
                dadosQuestao = dadosQuestoes
                dadosQuestao.forEach(resposta => {
                    todosPontosQuestao.push(resposta.pontos)
                });
            })
        setTimeout(() => {
            for (var i = 1; i <= todosPontosQuestao.length; i++) {
                totalPontos += todosPontosQuestao[i - 1]
            }
            pontuacaoTotal.innerHTML = `/${totalPontos}`
        }, 100);
    }

    function buscarDadosQuiz() {
        fetch(`/perfilRoute/buscarDadosQuiz?pkUsuario=${idUsuario}`)
            .then(response => response.json())
            .then(dadosQuiz => {
                dadosQuizzes = dadosQuiz
                dadosQuizzes.forEach(resposta => {
                    totalQuizzes.push(resposta.idQuiz)
                    todasPontuacaoQuiz.push(resposta.pontos)
                });
            })
        setTimeout(() => {
            qtdQuizzes.innerHTML = `<p><span>${totalQuizzes.length}</span></p>
                <p>Quizzes realizados</p>`
        }, 100);
    }

</script>
<!-- https://vinicius123.my.canva.site/ -->
<!-- https://vinicius123.my.canva.site/p-gina-de-perfil-do-usu-rio-site-sobre-bleach -->